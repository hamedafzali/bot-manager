<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ bot.config.name }} - Bot Details</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      .action-button {
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1rem 1.5rem;
        font-weight: 600;
        border-radius: 0.75rem;
        color: white;
        transition: all 0.3s ease;
        transform: scale(1);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        position: relative;
        overflow: hidden;
        border: none;
        cursor: pointer;
        text-decoration: none;
      }

      .action-button::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s;
      }

      .action-button:hover::before {
        left: 100%;
      }

      .run-button {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
      }

      .run-button:hover {
        background: linear-gradient(135deg, #059669 0%, #047857 100%);
        box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        transform: scale(1.05);
      }

      .test-button {
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
      }

      .test-button:hover {
        background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
        box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        transform: scale(1.05);
      }

      .stop-button {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
      }

      .stop-button:hover {
        background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        transform: scale(1.05);
      }

      .edit-button {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
      }

      .edit-button:hover {
        background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
        box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        transform: scale(1.05);
      }

      .delete-button {
        background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
        box-shadow: 0 4px 15px rgba(107, 114, 128, 0.3);
      }

      .delete-button:hover {
        background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
        box-shadow: 0 6px 20px rgba(107, 114, 128, 0.4);
        transform: scale(1.05);
      }

      .button-icon {
        transition: transform 0.2s;
        margin-right: 0.5rem;
      }

      .action-button:hover .button-icon {
        transform: scale(1.2);
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg">
      <div class="container mx-auto px-4">
        <div class="flex items-center justify-between h-16">
          <div class="flex items-center space-x-4">
            <div class="bg-blue-600 p-2 rounded-lg">
              <i class="fas fa-robot text-white text-xl"></i>
            </div>
            <div>
              <h1 class="text-xl font-bold text-gray-800">
                {{ bot.config.name }}
              </h1>
              <p class="text-sm text-gray-600">Bot Details</p>
            </div>
          </div>
          <a
            href="{{ url_for('dashboard') }}"
            class="text-gray-600 hover:text-gray-800 px-3 py-2 rounded-md text-sm font-medium"
          >
            <i class="fas fa-home mr-1"></i>Dashboard
          </a>
        </div>
      </div>
    </nav>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %}
    <div class="container mx-auto px-4 pt-4">
      {% for category, message in messages %}
      <div
        class="alert {% if category == 'error' %}bg-red-100 border-red-400 text-red-700{% else %}bg-green-100 border-green-400 text-green-700{% endif %} border px-4 py-3 rounded-lg mb-2"
      >
        <div class="flex items-center">
          <i
            class="fas {% if category == 'error' %}fa-exclamation-circle{% else %}fa-check-circle{% endif %} mr-2"
          ></i>
          {{ message }}
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %} {% endwith %}

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
      <div class="max-w-4xl mx-auto">
        <!-- Bot Header -->
        <div class="bg-white rounded-xl shadow-lg p-8 mb-6">
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
              <div
                class="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center"
              >
                <i class="fas fa-robot text-white text-2xl"></i>
              </div>
              <div>
                <h2 class="text-2xl font-bold text-gray-800">
                  {{ bot.config.name }}
                </h2>
                <p class="text-lg text-gray-600">
                  {{ bot.config.city_name }}, {{ bot.config.country_code }}
                </p>
                <div class="flex items-center space-x-2 mt-2">
                  <span
                    class="px-3 py-1 text-sm font-medium rounded-full {% if bot.status == 'idle' %}bg-blue-100 text-blue-800 {% elif bot.status == 'running' %}bg-yellow-100 text-yellow-800 {% elif bot.status == 'connected' %}bg-green-100 text-green-800 {% elif bot.status == 'error' %}bg-red-100 text-red-800 {% else %}bg-gray-100 text-gray-800{% endif %}"
                  >
                    {{ bot.status|title }}
                  </span>
                  {% if bot.config.is_active %}
                  <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                  {% else %}
                  <span class="w-2 h-2 bg-gray-400 rounded-full"></span>
                  {% endif %}
                </div>
              </div>
            </div>

            <div class="flex space-x-2">
              <a
                href="{{ url_for('edit_bot', bot_id=bot.id) }}"
                class="text-blue-600 hover:text-blue-800"
              >
                <i class="fas fa-edit"></i>
              </a>
              <a
                href="{{ url_for('run_bot', bot_id=bot.id) }}"
                class="text-green-600 hover:text-green-800"
              >
                <i class="fas fa-play"></i>
              </a>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <!-- Configuration -->
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">
              <i class="fas fa-cog mr-2"></i>Configuration
            </h3>

            <div class="space-y-3">
              <div class="flex justify-between">
                <span class="text-sm text-gray-600">Language</span>
                <span class="text-sm font-medium"
                  >{{ bot.config.news_language.upper() }}</span
                >
              </div>
              <div class="flex justify-between">
                <span class="text-sm text-gray-600">Connection</span>
                <span class="text-sm font-medium"
                  >{{ bot.config.connection.connection_type|title if
                  bot.config.connection else 'Not Configured' }}</span
                >
              </div>
              <div class="flex justify-between">
                <span class="text-sm text-gray-600">Last Message</span>
                <span class="text-sm font-medium"
                  >{{ bot.last_message[:16] if bot.last_message else 'Never'
                  }}</span
                >
              </div>
              <div class="flex justify-between">
                <span class="text-sm text-gray-600">Messages</span>
                <span class="text-sm font-medium"
                  >{{ bot.total_messages if bot.total_messages is defined else 0
                  }}</span
                >
              </div>
              <div class="flex justify-between">
                <span class="text-sm text-gray-600">Created</span>
                <span class="text-sm font-medium"
                  >{{ bot.created_at[:10] if bot.created_at else 'Unknown'
                  }}</span
                >
              </div>
            </div>
          </div>

          <!-- Statistics -->
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">
              <i class="fas fa-chart-line mr-2"></i>Statistics
            </h3>

            {% if stats %}
            <div class="space-y-3">
              <div class="flex justify-between">
                <span class="text-sm text-gray-600">Total Runs</span>
                <span class="text-sm font-medium"
                  >{{ stats.total_runs if stats.total_runs else 0 }}</span
                >
              </div>
              <div class="flex justify-between">
                <span class="text-sm text-gray-600">Success Rate</span>
                <span class="text-sm font-medium"
                  >{{ "%.1f%%"|format(stats.success_rate * 100) if
                  stats.success_rate else "0%" }}</span
                >
              </div>
              <div class="flex justify-between">
                <span class="text-sm text-gray-600">Avg Duration</span>
                <span class="text-sm font-medium"
                  >{{ "%.2fs"|format(stats.avg_duration) if stats.avg_duration
                  else "0s" }}</span
                >
              </div>
              <div class="flex justify-between">
                <span class="text-sm text-gray-600">Posts/Run</span>
                <span class="text-sm font-medium"
                  >{{ "%.1f"|format(stats.posts_per_run) if stats.posts_per_run
                  else "0" }}</span
                >
              </div>
            </div>
            {% else %}
            <p class="text-sm text-gray-500">No statistics available yet</p>
            {% endif %}
          </div>

          <!-- Actions -->
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">
              <i class="fas fa-play-circle mr-2"></i>Actions
            </h3>

            <div class="space-y-3">
              <a
                href="{{ url_for('run_bot', bot_id=bot.id) }}"
                class="action-button run-button"
              >
                <i class="fas fa-play button-icon"></i>
                Run Bot Now
              </a>

              <button onclick="testBot()" class="action-button test-button">
                <i class="fas fa-paper-plane button-icon"></i>
                Send Test Message
              </button>

              <button onclick="stopBot()" class="action-button stop-button">
                <i class="fas fa-stop-circle button-icon"></i>
                Stop Bot
              </button>

              <a
                href="{{ url_for('edit_bot', bot_id=bot.id) }}"
                class="action-button edit-button"
              >
                <i class="fas fa-edit button-icon"></i>
                Edit Configuration
              </a>

              <form
                method="POST"
                action="{{ url_for('delete_bot', bot_id=bot.id) }}"
                onsubmit="
                  return confirm(
                    'Are you sure you want to delete this bot? This action cannot be undone.',
                  );
                "
                class="mt-3"
              >
                <button type="submit" class="action-button delete-button">
                  <i class="fas fa-trash button-icon"></i>
                  Delete Bot
                </button>
              </form>
            </div>
          </div>
        </div>

        <!-- Recent Runs -->
        {% if stats and stats.recent_runs %}
        <div class="bg-white rounded-xl shadow-lg p-6 mt-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">
            <i class="fas fa-history mr-2"></i>Recent Runs
          </h3>

          <div class="space-y-2">
            {% for run in stats.recent_runs %}
            <div
              class="flex items-center justify-between p-3 bg-gray-50 rounded-lg"
            >
              <div class="flex items-center space-x-3">
                <span
                  class="px-2 py-1 text-xs font-medium rounded-full {% if run.status == 'success' %}bg-green-100 text-green-800 {% elif run.status == 'error' %}bg-red-100 text-red-800 {% else %}bg-gray-100 text-gray-800{% endif %}"
                >
                  {{ run.status|title }}
                </span>
                <span class="text-sm text-gray-600"
                  >{{ run.run_time[:16] }}</span
                >
              </div>
              <div class="text-right">
                <div class="text-sm text-gray-600">
                  Processed: {{ run.processed }} | Posted: {{ run.posted }}
                </div>
                <div class="text-xs text-gray-500">
                  Duration: {{ "%.2fs"|format(run.duration) }}
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}
      </div>
    </main>

    <script>
      async function stopBot() {
        const botId = "{{ bot.id }}";

        if (
          !confirm(
            "‚ö†Ô∏è Are you sure you want to STOP this bot?\\n\\nThis will immediately halt all bot operations and message processing.",
          )
        ) {
          return;
        }

        try {
          const response = await fetch("/bot/" + botId + "/stop", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
          });

          const result = await response.json();

          if (response.ok) {
            alert("‚úÖ Bot stopped successfully! All operations halted.");
            location.reload();
          } else {
            alert("‚ùå Error stopping bot: " + result.error);
          }
        } catch (error) {
          alert("‚ùå Connection error: " + error.message);
        }
      }

      async function testBot() {
        const botId = "{{ bot.id }}";

        if (
          !confirm(
            "üìß Send a test message to verify the bot connection?\\n\\nThis will send a test message to your configured Telegram channel.",
          )
        ) {
          return;
        }

        try {
          const response = await fetch("/bot/" + botId + "/test", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              message:
                "üß™ Test message from Bot Manager\\n\\n‚úÖ Your bot connection is working correctly!",
            }),
          });

          const result = await response.json();

          if (response.ok) {
            alert(
              "‚úÖ Test message sent successfully! Check your Telegram channel.",
            );
          } else {
            alert("‚ùå Error sending test message: " + result.error);
          }
        } catch (error) {
          alert("‚ùå Connection error: " + error.message);
        }
      }
    </script>
  </body>
</html>

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bot Manager Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      @keyframes slideIn {
        from {
          transform: translateY(-10px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
      .slide-in {
        animation: slideIn 0.3s ease-out;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }
      .animate-pulse-slow {
        animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }

      .glass-effect {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.18);
      }

      .gradient-bg {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .card-hover {
        transition: all 0.3s ease;
      }
      .card-hover:hover {
        transform: translateY(-5px);
        box-shadow:
          0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }

      .service-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 8px;
      }
      .service-online {
        background-color: #10b981;
      }
      .service-offline {
        background-color: #ef4444;
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <!-- Background Pattern -->
    <div class="fixed inset-0 -z-10 overflow-hidden">
      <div
        class="absolute -top-40 -right-40 w-80 h-80 bg-purple-300 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-pulse-slow"
      ></div>
      <div
        class="absolute -bottom-40 -left-40 w-80 h-80 bg-yellow-300 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-pulse-slow"
        style="animation-delay: 2s"
      ></div>
      <div
        class="absolute top-40 left-40 w-80 h-80 bg-pink-300 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-pulse-slow"
        style="animation-delay: 4s"
      ></div>
    </div>

    <!-- Navigation -->
    <nav class="glass-effect shadow-lg sticky top-0 z-50">
      <div class="container mx-auto px-4">
        <div class="flex items-center justify-between h-16">
          <div class="flex items-center space-x-4">
            <div class="gradient-bg p-2 rounded-lg">
              <i class="fas fa-robot text-white text-xl"></i>
            </div>
            <div>
              <h1 class="text-xl font-bold text-gray-800">Bot Manager</h1>
              <p class="text-xs text-gray-600">Professional Dashboard</p>
            </div>
          </div>
          <div class="flex items-center space-x-4">
            <div class="flex items-center text-sm text-gray-600">
              <span
                class="service-indicator service-online"
                id="manager-status"
              ></span>
              Bot Manager
            </div>
            <div class="flex items-center text-sm text-gray-600">
              <span
                class="service-indicator service-online"
                id="news-status"
              ></span>
              News Service
            </div>
            <a
              href="{{ url_for('add_bot') }}"
              class="gradient-bg hover:opacity-90 text-white px-4 py-2 rounded-lg text-sm font-medium transition flex items-center"
            >
              <i class="fas fa-plus mr-2"></i>Add Bot
            </a>
          </div>
        </div>
      </div>
    </nav>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %}
    <div class="container mx-auto px-4 pt-4">
      {% for category, message in messages %}
      <div
        class="slide-in glass-effect rounded-xl p-4 mb-2 {% if category == 'error' %}bg-red-100 border-red-400 text-red-700{% else %}bg-green-100 border-green-400 text-green-700{% endif %}"
      >
        <div class="flex items-center">
          <i
            class="fas {% if category == 'error' %}fa-exclamation-circle{% else %}fa-check-circle{% endif %} mr-2"
          ></i>
          {{ message }}
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %} {% endwith %}

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
      <!-- Stats Overview -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="glass-effect rounded-xl p-6 card-hover">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-600">Total Bots</p>
              <p class="text-2xl font-bold text-gray-900">
                {{ stats.total_bots if stats else 0 }}
              </p>
            </div>
            <div class="p-3 bg-purple-100 rounded-full">
              <i class="fas fa-robots text-purple-600 text-xl"></i>
            </div>
          </div>
        </div>

        <div class="glass-effect rounded-xl p-6 card-hover">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-600">Active Bots</p>
              <p class="text-2xl font-bold text-green-600">
                {{ stats.active_bots if stats else 0 }}
              </p>
            </div>
            <div class="p-3 bg-green-100 rounded-full">
              <i class="fas fa-play-circle text-green-600 text-xl"></i>
            </div>
          </div>
        </div>

        <div class="glass-effect rounded-xl p-6 card-hover">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-600">Total Posts</p>
              <p class="text-2xl font-bold text-blue-600">
                {{ stats.total_posts if stats else 0 }}
              </p>
            </div>
            <div class="p-3 bg-blue-100 rounded-full">
              <i class="fas fa-paper-plane text-blue-600 text-xl"></i>
            </div>
          </div>
        </div>

        <div class="glass-effect rounded-xl p-6 card-hover">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-600">Cities Covered</p>
              <p class="text-2xl font-bold text-orange-600">
                {{ stats.cities_covered if stats else 0 }}
              </p>
            </div>
            <div class="p-3 bg-orange-100 rounded-full">
              <i class="fas fa-globe text-orange-600 text-xl"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Bots Grid -->
      <div class="mb-8">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-gray-800">
            <i class="fas fa-cogs mr-2"></i>Your Bots
          </h2>
          <div class="flex items-center space-x-2">
            <button
              onclick="refreshData()"
              class="px-4 py-2 glass-effect border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition"
            >
              <i class="fas fa-sync-alt mr-2"></i>Refresh
            </button>
            <button
              onclick="exportData()"
              class="px-4 py-2 glass-effect border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition"
            >
              <i class="fas fa-download mr-2"></i>Export
            </button>
          </div>
        </div>

        {% if bots %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {% for bot in bots %}
          <div
            class="glass-effect rounded-xl p-6 card-hover {% if not bot.config.is_active %}opacity-75{% endif %}"
          >
            <!-- Bot Header -->
            <div class="flex items-center justify-between mb-4">
              <div class="flex items-center space-x-3">
                <div
                  class="w-12 h-12 gradient-bg rounded-full flex items-center justify-center"
                >
                  <i class="fas fa-robot text-white text-lg"></i>
                </div>
                <div>
                  <h3 class="font-semibold text-gray-800">
                    {{ bot.config.name }}
                  </h3>
                  <p class="text-sm text-gray-600">
                    {{ bot.config.description or 'Real-time Bot' }}
                  </p>
                </div>
              </div>
              <div class="flex items-center space-x-2">
                {% if bot.config.is_active %}
                <span
                  class="w-2 h-2 bg-green-500 rounded-full animate-pulse-slow"
                ></span>
                {% else %}
                <span class="w-2 h-2 bg-gray-400 rounded-full"></span>
                {% endif %}
              </div>
            </div>

            <!-- Bot Status -->
            <div class="mb-4">
              <div class="flex items-center justify-between text-sm mb-2">
                <span class="text-gray-600">Status</span>
                <span
                  class="px-2 py-1 text-xs font-medium rounded-full {% if bot.status == 'idle' %}bg-blue-100 text-blue-800 {% elif bot.status == 'running' %}bg-yellow-100 text-yellow-800 {% elif bot.status == 'connected' %}bg-green-100 text-green-800 {% elif bot.status == 'error' %}bg-red-100 text-red-800 {% else %}bg-gray-100 text-gray-800{% endif %}"
                >
                  {{ bot.status|title }}
                </span>
              </div>
              <div class="flex items-center justify-between text-sm mb-2">
                <span class="text-gray-600">Connection</span>
                <span class="font-medium"
                  >{{ bot.config.connection.connection_type|title if
                  bot.config.connection else 'Not Configured' }}</span
                >
              </div>
              <div class="flex items-center justify-between text-sm mb-2">
                <span class="text-gray-600">Last Message</span>
                <span class="font-medium"
                  >{{ bot.last_message[:16] if bot.last_message else 'Never'
                  }}</span
                >
              </div>
              <div class="flex items-center justify-between text-sm">
                <span class="text-gray-600">Messages</span>
                <span class="font-medium"
                  >{{ bot.total_messages if bot.total_messages is defined else 0
                  }}</span
                >
              </div>
            </div>

            <!-- Bot Actions -->
            <div
              class="flex items-center justify-between pt-4 border-t border-gray-200"
            >
              <div class="flex space-x-2">
                <a
                  href="{{ url_for('run_bot', bot_id=bot.id) }}"
                  class="text-green-600 hover:text-green-800 transition"
                  title="Run Bot"
                >
                  <i class="fas fa-play"></i>
                </a>
                <a
                  href="{{ url_for('bot_details', bot_id=bot.id) }}"
                  class="text-blue-600 hover:text-blue-800 transition"
                  title="View Details"
                >
                  <i class="fas fa-chart-line"></i>
                </a>
              </div>
              <div class="flex space-x-2">
                <a
                  href="{{ url_for('edit_bot', bot_id=bot.id) }}"
                  class="text-gray-600 hover:text-gray-800 transition"
                  title="Edit Bot"
                >
                  <i class="fas fa-edit"></i>
                </a>
                <form
                  method="POST"
                  action="{{ url_for('delete_bot', bot_id=bot.id) }}"
                  onsubmit="
                    return confirm(
                      'Are you sure you want to delete this bot? This action cannot be undone.',
                    );
                  "
                >
                  <button
                    type="submit"
                    class="text-red-600 hover:text-red-800 transition"
                    title="Delete Bot"
                  >
                    <i class="fas fa-trash"></i>
                  </button>
                </form>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <!-- Empty State -->
        <div class="text-center py-12">
          <div
            class="w-24 h-24 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4"
          >
            <i class="fas fa-robot text-gray-400 text-3xl"></i>
          </div>
          <h3 class="text-xl font-semibold text-gray-800 mb-2">
            No bots configured
          </h3>
          <p class="text-gray-600 mb-6">
            Get started by creating your first professional news bot
          </p>
          <a
            href="{{ url_for('add_bot') }}"
            class="inline-flex items-center px-6 py-3 gradient-bg hover:opacity-90 text-white font-medium rounded-lg transition"
          >
            <i class="fas fa-plus mr-2"></i>Create Your First Bot
          </a>
        </div>
        {% endif %}
      </div>
    </main>

    <!-- Chart Container -->
    <div
      class="fixed bottom-4 right-4 w-80 glass-effect rounded-xl p-4 hidden"
      id="chartContainer"
    >
      <div class="flex items-center justify-between mb-2">
        <h3 class="text-lg font-semibold text-gray-800">
          Performance Overview
        </h3>
        <button
          onclick="toggleChart()"
          class="text-gray-600 hover:text-gray-800"
        >
          <i class="fas fa-times"></i>
        </button>
      </div>
      <canvas id="performanceChart" width="300" height="200"></canvas>
    </div>

    <!-- Floating Action Button -->
    <div class="fixed bottom-4 left-4">
      <button
        onclick="toggleChart()"
        class="gradient-bg text-white p-3 rounded-full shadow-lg hover:opacity-90 transition"
      >
        <i class="fas fa-chart-bar"></i>
      </button>
    </div>

    <script>
      // Service status checking
      function checkServiceStatus() {
        fetch("/health")
          .then((response) => response.json())
          .then((data) => {
            document.getElementById("manager-status").className =
              "service-indicator service-online";
          })
          .catch((error) => {
            document.getElementById("manager-status").className =
              "service-indicator service-offline";
          });
      }

      // Auto-refresh every 30 seconds
      setInterval(() => {
        checkServiceStatus();
        location.reload();
      }, 30000);

      // Initial check
      checkServiceStatus();

      // Chart functionality
      let chartVisible = false;

      function toggleChart() {
        const container = document.getElementById("chartContainer");
        chartVisible = !chartVisible;
        container.classList.toggle("hidden");

        if (chartVisible) {
          initChart();
        }
      }

      function initChart() {
        const ctx = document
          .getElementById("performanceChart")
          .getContext("2d");
        new Chart(ctx, {
          type: "line",
          data: {
            labels: ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"],
            datasets: [
              {
                label: "Posts per Day",
                data: [12, 19, 8, 15, 22, 18, 25],
                borderColor: "rgb(75, 192, 192)",
                backgroundColor: "rgba(75, 192, 192, 0.2)",
                tension: 0.1,
              },
            ],
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                display: false,
              },
            },
            scales: {
              y: {
                beginAtZero: true,
              },
            },
          },
        });
      }

      function refreshData() {
        location.reload();
      }

      function exportData() {
        // Export functionality
        alert("Export functionality coming soon!");
      }
    </script>
  </body>
</html>
